@inherits LayoutComponentBase
@using Microsoft.AspNetCore.Components.Authorization
@inject AuthenticationStateProvider AuthenticationStateProvider
@inject NavigationManager Navigation

<CascadingAuthenticationState>
    <div class="user-dashboard-page">
        <!-- User Dashboard Navigation -->
        <nav class="navbar">
            <div class="navbar-container">
                <a href="/User/UserDashboard" class="navbar-brand">
                    <span class="pig-icon">🐷</span> PiggyPro
                </a>
                <div class="nav-menu">
                    <NavLink href="/User/UserDashboard" class="nav-btn" Match="NavLinkMatch.All">
                        Dashboard
                    </NavLink>
                    <NavLink href="/Transactions" class="nav-btn">
                        Transactions
                    </NavLink>
                    <NavLink href="/Budgets" class="nav-btn">
                        Budget
                    </NavLink>
                    <NavLink href="/goals" class="nav-btn">
                        Goals
                    </NavLink>
                    <NavLink href="/Reports" class="nav-btn">
                        Reports
                    </NavLink>
                </div>
                <AuthorizeView>
                    <Authorized>
                        <div class="user-section">
                            <a href="Account/Manage" class="user-name">@fullName</a>
                            <a href="/Account/Logout" class="btn-logout">Logout</a>
                        </div>
                    </Authorized>
                </AuthorizeView>
            </div>
        </nav>

        <main class="main-content">
            @Body
        </main>
    </div>
</CascadingAuthenticationState>



@code {
    private string fullName = string.Empty;

    protected override async Task OnInitializedAsync()
    {
        await LoadUserNameFromClaims();
    }

    private async Task LoadUserNameFromClaims()
    {
        var authState = await AuthenticationStateProvider.GetAuthenticationStateAsync();
        var user = authState.User;

        if (user?.Identity?.IsAuthenticated == true)
        {
            // Read FirstName and LastName from claims
            var firstName = user.FindFirst("FirstName")?.Value;
            var lastName = user.FindFirst("LastName")?.Value;

            if (!string.IsNullOrWhiteSpace(firstName))
            {
                fullName = $"{firstName} {lastName}".Trim();
            }
            else
            {
                // Fallback to email
                fullName = user.Identity?.Name ?? "User";
            }
        }
    }
}