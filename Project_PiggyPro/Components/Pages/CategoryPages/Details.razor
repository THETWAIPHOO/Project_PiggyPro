@page "/categories/details"
@layout AdminLayout
@rendermode InteractiveServer
@using Microsoft.EntityFrameworkCore
@using Project_PiggyPro.Domain
@using Project_PiggyPro.Data
@inject IDbContextFactory<Project_PiggyProContext> DbFactory
@inject NavigationManager Navigation

<PageTitle>Category Details - PiggyPro Admin</PageTitle>

<div class="details-container">
    <div class="page-header">
        <div>
            <h1>📁 Category Details</h1>
        </div>
        <div class="header-actions">
            <a href="/categories/edit?id=@Id" class="btn-edit">✏️ Edit</a>
            <a href="/categories" class="btn-back">← Back</a>
        </div>
    </div>

    @if (isLoading)
    {
        <div class="loading-state">
            <p>Loading category...</p>
        </div>
    }
    else if (category == null)
    {
        <div class="error-card">
            <h2>Category Not Found</h2>
            <p>The category you're looking for doesn't exist.</p>
            <a href="/categories" class="btn-primary">Back to Categories</a>
        </div>
    }
    else
    {
        <div class="details-card">
            <div class="category-header">
                <div class="category-main">
                    <h2>@category.CategoryName</h2>
                    <span class="category-badge @category.CategoryType.ToLower()">
                        @GetCategoryIcon(category.CategoryType) @category.CategoryType
                    </span>
                </div>
            </div>

            <div class="details-grid">
                <div class="detail-item">
                    <span class="detail-icon">📅</span>
                    <div class="detail-content">
                        <div class="detail-label">Created Date</div>
                        <div class="detail-value">@category.DateCreated.ToString("MMMM dd, yyyy 'at' hh:mm tt")</div>
                    </div>
                </div>

                <div class="detail-item">
                    <span class="detail-icon">🔄</span>
                    <div class="detail-content">
                        <div class="detail-label">Last Updated</div>
                        <div class="detail-value">@category.DateUpdated.ToString("MMMM dd, yyyy 'at' hh:mm tt")</div>
                    </div>
                </div>

                <div class="detail-item">
                    <span class="detail-icon">👤</span>
                    <div class="detail-content">
                        <div class="detail-label">Created By</div>
                        <div class="detail-value">@category.CreatedBy</div>
                    </div>
                </div>

                <div class="detail-item">
                    <span class="detail-icon">✏️</span>
                    <div class="detail-content">
                        <div class="detail-label">Updated By</div>
                        <div class="detail-value">@category.UpdatedBy</div>
                    </div>
                </div>
            </div>

            <div class="actions-section">
                <a href="/categories/edit?id=@category.Id" class="btn-action edit">Edit Category</a>
                <a href="/categories/delete?id=@category.Id" class="btn-action delete">Delete Category</a>
            </div>
        </div>
    }
</div>

@code {
    [SupplyParameterFromQuery]
    private int Id { get; set; }

    private Category? category;
    private bool isLoading = true;

    protected override async Task OnInitializedAsync()
    {
        await LoadCategory();
    }

    private async Task LoadCategory()
    {
        try
        {
            using var context = DbFactory.CreateDbContext();
            category = await context.Category.FirstOrDefaultAsync(c => c.Id == Id);
        }
        catch (Exception ex)
        {
            Console.WriteLine($"Error loading category: {ex.Message}");
        }
        finally
        {
            isLoading = false;
        }
    }

    private string GetCategoryIcon(string categoryType)
    {
        return categoryType?.ToLower() switch
        {
            "income" => "💰",
            "expense" => "💸",
            "savings" => "🐷",
            _ => "📁"
        };
    }
}